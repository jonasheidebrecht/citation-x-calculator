<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citation X Takeoff Field Length Interpolator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, select { margin: 4px; }
    .result { margin-top: 20px; font-size: 1.2em; color: #003366; }
    table { border-collapse: collapse; margin-top: 20px; }
    td, th { border: 1px solid #ddd; padding: 4px 8px; }
  </style>
</head>
<body>
  <h2>Citation X Takeoff Field Length (15° Flaps) Interpolator</h2>
  <form id="interpForm">
    <label>Elevation (ft): 
      <select id="elevation">
        <option value="0">0</option>
        <option value="1000">1000</option>
        <option value="2000">2000</option>
        <option value="3000">3000</option>
        <option value="4000">4000</option>
        <option value="5000">5000</option>
        <option value="6000">6000</option>
        <option value="7000">7000</option>
      </select>
    </label>
    <label>Temperature (°C): <input type="number" id="temp" value="15"></label>
    <label>Takeoff Weight (lb): <input type="number" id="weight" value="36000" min="25000" max="36100"></label>
    <button type="submit">Interpolate</button>
  </form>
  <div class="result" id="result"></div>
  <script>
    // Data: Elevation (ft) -> Temperature (°C) -> Weight (lb) -> Field Length (ft)
    // Only a subset of the data is included for brevity. Add more as needed!
    const data = {
      0: {
        0:   {36100: 4890, 35000: 4610, 34000: 4340, 33000: 4080, 31000: 3680, 29000: 3520, 27000: 3440, 25000: 3360},
        10:  {36100: 5050, 35000: 4760, 34000: 4490, 33000: 4220, 31000: 3800, 29000: 3620, 27000: 3520, 25000: 3440},
        15:  {36100: 5140, 35000: 4850, 34000: 4560, 33000: 4300, 31000: 3850, 29000: 3670, 27000: 3560, 25000: 3480},
        20:  {36100: 5230, 35000: 4930, 34000: 4640, 33000: 4370, 31000: 3920, 29000: 3730, 27000: 3600, 25000: 3510},
        25:  {36100: 5340, 35000: 5030, 34000: 4740, 33000: 4460, 31000: 3990, 29000: 3800, 27000: 3640, 25000: 3550},
        30:  {36100: 5480, 35000: 5150, 34000: 4850, 33000: 4560, 31000: 4060, 29000: 3870, 27000: 3690, 25000: 3600},
        35:  {36100: 5910, 35000: 5520, 34000: 5200, 33000: 4890, 31000: 4260, 29000: 3890, 27000: 3710, 25000: 3560},
        40:  {36100: 6450, 35000: 6000, 34000: 5620, 33000: 5270, 31000: 4580, 29000: 3970, 27000: 3730, 25000: 3530}
      },
      1000: {
        0:   {36100: 5050, 35000: 4760, 34000: 4480, 33000: 4220, 31000: 3800, 29000: 3630, 27000: 3540, 25000: 3460},
        10:  {36100: 5220, 35000: 4920, 34000: 4640, 33000: 4370, 31000: 3920, 29000: 3730, 27000: 3630, 25000: 3540},
        15:  {36100: 5310, 35000: 5010, 34000: 4720, 33000: 4440, 31000: 3980, 29000: 3790, 27000: 3670, 25000: 3580},
        20:  {36100: 5420, 35000: 5100, 34000: 4810, 33000: 4520, 31000: 4050, 29000: 3860, 27000: 3710, 25000: 3620},
        25:  {36100: 5550, 35000: 5210, 34000: 4910, 33000: 4620, 31000: 4130, 29000: 3930, 27000: 3750, 25000: 3660}
      },
      2000: {
        0:   {36100: 5210, 35000: 4920, 34000: 4630, 33000: 4360, 31000: 3930, 29000: 3750, 27000: 3660, 25000: 3570},
        10:  {36100: 5400, 35000: 5080, 34000: 4790, 33000: 4510, 31000: 4060, 29000: 3860, 27000: 3740, 25000: 3650},
        15:  {36100: 5510, 35000: 5170, 34000: 4880, 33000: 4590, 31000: 4120, 29000: 3920, 27000: 3780, 25000: 3690},
        20:  {36100: 5640, 35000: 5280, 34000: 4980, 33000: 4680, 31000: 4200, 29000: 4000, 27000: 3820, 25000: 3730},
        25:  {36100: 5960, 35000: 5560, 34000: 5220, 33000: 4920, 31000: 4290, 29000: 4050, 27000: 3850, 25000: 3730}
      },
      // Add additional elevations as needed...
    };

    // Helper: Find the two bracketing values in an array for a given value
    function bracket(arr, val) {
      arr = arr.map(Number).sort((a, b) => a - b);
      if (val <= arr[0]) return [arr[0], arr[0]];
      if (val >= arr[arr.length - 1]) return [arr[arr.length - 1], arr[arr.length - 1]];
      for (let i = 0; i < arr.length - 1; i++) {
        if (val >= arr[i] && val <= arr[i + 1]) return [arr[i], arr[i + 1]];
      }
    }

    // Bilinear interpolation
    function interpolate(elev, temp, weight) {
      // Get available elevations
      const elevs = Object.keys(data).map(Number);
      const [e0, e1] = bracket(elevs, elev);

      // For each elevation, get available temps
      function getTemps(e) { return Object.keys(data[e]).map(Number); }
      const [t0, t1] = bracket(getTemps(e0), temp);
      const [t2, t3] = bracket(getTemps(e1), temp);

      // For each (elev, temp), get available weights
      function getWeights(e, t) { return Object.keys(data[e][t]).map(Number); }
      const [w00, w01] = bracket(getWeights(e0, t0), weight);
      const [w10, w11] = bracket(getWeights(e0, t1), weight);
      const [w20, w21] = bracket(getWeights(e1, t2), weight);
      const [w30, w31] = bracket(getWeights(e1, t3), weight);

      // Interpolate for each corner
      function interp2(w0, w1, v0, v1, w) {
        return w0 === w1 ? v0 : v0 + (v1 - v0) * (w - w0) / (w1 - w0);
      }
      function getVal(e, t, w) {
        const [w0, w1] = bracket(getWeights(e, t), w);
        return interp2(w0, w1, data[e][t][w0], data[e][t][w1], w);
      }
      // Interpolate in temp
      const f_e0 = interp2(t0, t1, getVal(e0, t0, weight), getVal(e0, t1, weight), temp);
      const f_e1 = interp2(t2, t3, getVal(e1, t2, weight), getVal(e1, t3, weight), temp);
      // Interpolate in elevation
      return interp2(e0, e1, f_e0, f_e1, elev);
    }

    document.getElementById('interpForm').addEventListener('submit', function(e){
      e.preventDefault();
      const elev = parseInt(document.getElementById('elevation').value);
      const temp = parseFloat(document.getElementById('temp').value);
      const weight = parseFloat(document.getElementById('weight').value);

      // Check if within data range
      if (!data[elev]) {
        document.getElementById('result').textContent = "Elevation not in data set.";
        return;
      }
      const temps = Object.keys(data[elev]).map(Number);
      if (temp < Math.min(...temps) || temp > Math.max(...temps)) {
        document.getElementById('result').textContent = "Temperature out of data range for this elevation.";
        return;
      }
      const weights = Object.keys(data[elev][temps[0]]).map(Number);
      if (weight < Math.min(...weights) || weight > Math.max(...weights)) {
        document.getElementById('result').textContent = "Weight out of data range.";
        return;
      }

      const fieldLen = interpolate(elev, temp, weight);
      document.getElementById('result').innerHTML = `<b>Estimated Takeoff Field Length:</b> <span style="color:darkgreen">${fieldLen.toFixed(0)} ft</span>`;
    });
  </script>
</body>
</html>
