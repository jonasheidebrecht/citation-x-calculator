<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citation X Takeoff Field Length Calculator (15° Flaps)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    label { display: block; margin-top: 1em; }
    input[type="number"] { width: 100px; }
    .result { margin-top: 1.5em; font-weight: bold; }
    .note { font-size: 0.9em; color: #555; }
  </style>
</head>
<body>
  <h2>Citation X Takeoff Field Length Calculator (15° Flaps)</h2>
  <form id="takeoffForm">
    <label>
      Takeoff Weight (lb):<br>
      <input type="number" id="weight" min="25000" max="36100" step="100" required>
    </label>
    <label>
      Ambient Temperature (°C):<br>
      <input type="number" id="temp" min="-20" max="50" step="1" required>
    </label>
    <label>
      Airport Elevation (ft):<br>
      <input type="number" id="elevation" min="0" max="8000" step="100" required>
    </label>
    <button type="submit">Calculate</button>
  </form>
  <div class="result" id="result"></div>
  <div class="note">
    <p>Data: Citation X Flight Planning Guide, 15° Flaps, Dry Runway, Zero Wind, Anti-Ice Off, Cabin Bleed Air On, Over 35 ft Screen Height.<br>
    Valid for: Elevations 0–8,000 ft, Weights 25,000–36,100 lb, Temps as per table. Interpolation only, extrapolation not supported.</p>
  </div>
  <script>
    // Elevations in feet
    const elevations = [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000];
    // Temperatures in °C (may vary by elevation)
    const temps = [
      [0,10,15,20,25,30,35,40,45,50],      // 0 ft
      [0,10,15,20,25,30,35,40,45,50],      // 1000 ft
      [0,10,15,20,25,30,35,40,45,50],      // 2000 ft
      [-10,0,10,15,20,25,30,35,40,45],     // 3000 ft
      [-10,0,10,15,20,25,30,35,40,45],     // 4000 ft
      [-10,0,5,10,15,20,25,30,35,40],      // 5000 ft
      [-20,-10,0,5,10,15,20,25,30,35],     // 6000 ft
      [-20,-10,0,5,10,15,20,25,30,35],     // 7000 ft
    ];
    // Weights in lb
    const weights = [36100, 35000, 34000, 33000, 31000, 29000, 27000, 25000];

    // Takeoff field length data [elevation][temp][weight]
    // (null means missing data in the table)
    const distances = [
      // 0 ft
      [
        [4890, 4610, 4340, 4080, 3680, 3520, 3440, 3360],
        [5050, 4760, 4490, 4220, 3800, 3620, 3520, 3440],
        [5140, 4850, 4560, 4300, 3850, 3670, 3560, 3480],
        [5230, 4930, 4640, 4370, 3920, 3730, 3600, 3510],
        [5340, 5030, 4740, 4460, 3990, 3800, 3640, 3510],
        [5480, 5150, 4850, 4560, 4060, 3870, 3690, 3600],
        [5910, 5520, 5200, 4890, 4260, 3890, 3710, 3560],
        [6450, 6000, 5620, 5270, 4580, 3970, 3730, 3530],
        [null, null, 6110, 5720, 4950, 4280, 3730, 3540],
        [null, null, null, null, 5390, 4630, 3990, 3550]
      ],
      // 1000 ft
      [
        [5050, 4760, 4480, 4220, 3800, 3630, 3540, 3460],
        [5220, 4920, 4640, 4370, 3920, 3730, 3630, 3540],
        [5310, 5010, 4720, 4440, 3980, 3790, 3670, 3580],
        [5420, 5100, 4810, 4520, 4050, 3860, 3710, 3620],
        [5550, 5210, 4910, 4620, 4130, 3930, 3750, 3660],
        [5930, 5530, 5210, 4900, 4270, 3980, 3780, 3650],
        [6480, 6030, 5640, 5290, 4600, 3990, 3800, 3600],
        [null, 6590, 6120, 5730, 4970, 4290, 3810, 3610],
        [null, null, null, 6240, 5390, 4640, 4010, 3630],
        [null, null, null, null, 5880, 5040, 4330, 3700]
      ],
      // 2000 ft
      [
        [5210, 4920, 4630, 4360, 3930, 3750, 3660, 3570],
        [5400, 5080, 4790, 4510, 4060, 3860, 3740, 3650],
        [5510, 5170, 4880, 4590, 4120, 3920, 3780, 3690],
        [5640, 5280, 4980, 4680, 4200, 4000, 3820, 3730],
        [5960, 5560, 5220, 4920, 4290, 4050, 3850, 3730],
        [6500, 6040, 5650, 5300, 4620, 4050, 3870, 3690],
        [null, 6610, 6140, 5740, 4990, 4310, 3890, 3680],
        [null, null, null, 6250, 5400, 4650, 4020, 3710],
        [null, null, null, null, 5490, 4710, 4100, 4010],
        [null, null, null, null, null, 5490, 4710, 4010]
      ],
      // 3000 ft
      [
        [5220, 4920, 4640, 4370, 3930, 3750, 3660, 3570],
        [5410, 5090, 4800, 4510, 4060, 3870, 3770, 3680],
        [5620, 5260, 4960, 4670, 4190, 3990, 3850, 3760],
        [5740, 5370, 5060, 4760, 4260, 4060, 3890, 3800],
        [6000, 5600, 5260, 4950, 4320, 4120, 3910, 3810],
        [6530, 6080, 5670, 5330, 4640, 4130, 3950, 3770],
        [null, 6640, 6180, 5770, 5010, 4340, 3970, 3750],
        [null, null, 6760, 6260, 5420, 4670, 4040, 3780],
        [null, null, null, null, 5890, 5060, 4360, 3770],
        [null, null, null, null, null, 5500, 4720, 4020]
      ],
      // 4000 ft
      [
        [5420, 5100, 4800, 4520, 4060, 3870, 3780, 3680],
        [5630, 5270, 4970, 4680, 4190, 3990, 3880, 3790],
        [5850, 5460, 5140, 4840, 4330, 4120, 3970, 3870],
        [6040, 5640, 5290, 4980, 4390, 4190, 3990, 3890],
        [6580, 6130, 5710, 5360, 4680, 4210, 4010, 3850],
        [7190, 6680, 6210, 5790, 5040, 4360, 4050, 3820],
        [null, 6800, 6210, 6310, 5450, 4710, 4070, 3850],
        [null, null, null, null, 5910, 5080, 4380, 3860],
        [null, null, null, null, null, 5520, 4750, 4040],
        [null, null, null, null, null, 6000, 5130, 4360]
      ],
      // 5000 ft
      [
        [5610, 5260, 4960, 4670, 4200, 4000, 3900, 3800],
        [5840, 5450, 5130, 4830, 4340, 4130, 4010, 3910],
        [5950, 5550, 5210, 4910, 4410, 4200, 4050, 3950],
        [6120, 5710, 5340, 5030, 4470, 4260, 4080, 3980],
        [6630, 6170, 5760, 5400, 4710, 4290, 4080, 3930],
        [7250, 6730, 6260, 5830, 5070, 4400, 4120, 3890],
        [null, 6830, 6260, 6340, 5470, 5110, 4410, 3940],
        [null, null, null, 6930, 5930, 5530, 4760, 4060],
        [null, null, null, null, 6460, 5530, 4760, 4060],
        [null, null, null, null, null, 6020, 5150, 4380]
      ],
      // 6000 ft
      [
        [5930, 5540, 5210, 4900, 4320, 4120, 4000, 3900],
        [6170, 5760, 5380, 5070, 4470, 4260, 4110, 4000],
        [6300, 5870, 5480, 5160, 4540, 4330, 4150, 4050],
        [6680, 6220, 5800, 5430, 4740, 4380, 4160, 4020],
        [7310, 6780, 6310, 5870, 5110, 4430, 4190, 3980],
        [null, 7410, 6870, 6380, 5500, 4760, 4210, 3990],
        [null, null, null, 6940, 5930, 5120, 4420, 4030],
        [null, null, null, null, 6360, 5470, 4720, 4030],
        [null, null, null, null, null, 5870, 5040, 4300],
        [null, null, null, null, null, 6320, 5400, 4590]
      ],
      // 7000 ft
      [
        [6070, 5670, 5320, 5010, 4370, 4100, 3970, 3860],
        [6320, 5890, 5500, 5180, 4520, 4250, 4090, 3980],
        [6580, 6130, 5720, 5360, 4680, 4400, 4200, 4090],
        [6820, 6350, 5920, 5520, 4830, 4450, 4230, 4100],
        [7370, 6840, 6360, 5920, 5150, 4470, 4270, 4060],
        [null, 7410, 6880, 6390, 5510, 4770, 4300, 4070],
        [null, null, 7390, 6850, 5860, 5070, 4390, 4110],
        [null, null, null, 7360, 6250, 5390, 4650, 4150],
        [null, null, null, null, 6700, 5750, 4950, 4230],
        [null, null, null, null, null, 6150, 5280, 4500]
      ]
    ];

    // Helper: Find the two indices in arr that bracket val
    function bracketIndices(arr, val) {
      let i = 0;
      while (i < arr.length - 1 && val > arr[i + 1]) i++;
      return [i, Math.min(i + 1, arr.length - 1)];
    }

    // Returns table value if exact match, else null
    function getTableValue(elev, temp, weight) {
      const elevIdx = elevations.indexOf(elev);
      if (elevIdx === -1) return null;
      const tempIdx = temps[elevIdx].indexOf(temp);
      if (tempIdx === -1) return null;
      const weightIdx = weights.indexOf(weight);
      if (weightIdx === -1) return null;
      return distances[elevIdx][tempIdx][weightIdx];
    }

    // Trilinear interpolation (elevation, temperature, weight)
    function trilinearInterp(elev, temp, weight) {
      // Check for exact match
      const exact = getTableValue(elev, temp, weight);
      if (exact !== null) return exact;

      // Find bracketing elevations
      let [e0, e1] = bracketIndices(elevations, elev);
      // Find bracketing temps for each elevation
      let tArr0 = temps[e0], tArr1 = temps[e1];
      let [t0_0, t0_1] = bracketIndices(tArr0, temp);
      let [t1_0, t1_1] = bracketIndices(tArr1, temp);
      // Find bracketing weights
      let [w0, w1] = bracketIndices(weights, weight);

      // Fractions
      let eFrac = (elev - elevations[e0]) / (elevations[e1] - elevations[e0] || 1);
      let tFrac0 = (temp - temps[e0][t0_0]) / (temps[e0][t0_1] - temps[e0][t0_0] || 1);
      let tFrac1 = (temp - temps[e1][t1_0]) / (temps[e1][t1_1] - temps[e1][t1_0] || 1);
      let wFrac = (weight - weights[w0]) / (weights[w1] - weights[w0] || 1);

      function interp2D(eIdx, tIdx0, tIdx1, tFrac, wIdx0, wIdx1, wFrac) {
        let v00 = distances[eIdx][tIdx0][wIdx0];
        let v01 = distances[eIdx][tIdx0][wIdx1];
        let v10 = distances[eIdx][tIdx1][wIdx0];
        let v11 = distances[eIdx][tIdx1][wIdx1];
        if ([v00,v01,v10,v11].some(x=>x==null)) return null;
        let v0 = v00 + (v01 - v00) * wFrac;
        let v1 = v10 + (v11 - v10) * wFrac;
        return v0 + (v1 - v0) * tFrac;
      }

      let v0 = interp2D(e0, t0_0, t0_1, tFrac0, w0, w1, wFrac);
      let v1 = interp2D(e1, t1_0, t1_1, tFrac1, w0, w1, wFrac);
      if (v0 == null || v1 == null) return null;
      return v0 + (v1 - v0) * eFrac;
    }

    document.getElementById('takeoffForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const weight = parseFloat(document.getElementById('weight').value);
      const temp = parseFloat(document.getElementById('temp').value);
      const elev = parseFloat(document.getElementById('elevation').value);

      // Range checks
      if (elev < elevations[0] || elev > elevations[elevations.length-1] ||
          weight < weights[weights.length-1] || weight > weights[0]) {
        document.getElementById('result').textContent =
          "Input out of data range. Please check the limits in the note below.";
        return;
      }
      // Find closest temp range for this elevation
      let tArr = temps[bracketIndices(elevations, elev)[0]];
      if (temp < tArr[0] || temp > tArr[tArr.length-1]) {
        document.getElementById('result').textContent =
          "Temperature out of data range for this elevation.";
        return;
      }

      let result = trilinearInterp(elev, temp, weight);
      if (result == null || isNaN(result)) {
        document.getElementById('result').textContent =
          "Interpolation not possible for this combination (missing data in the table).";
      } else {
        document.getElementById('result').textContent =
          `Estimated Takeoff Field Length: ${result.toFixed(0)} feet`;
      }
    });
  </script>
</body>
</html>