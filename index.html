<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citation X Flight Performance</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gradient-to-br from-blue-100 to-purple-200 flex flex-col items-center justify-center min-h-screen p-4;
        }
        .calculator-container {
            @apply bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md my-6 transform transition-all duration-300 ease-in-out hover:scale-105 hover:shadow-3xl;
            border: 1px solid rgba(255, 255, 255, 0.3); /* Subtle white border for depth */
            backdrop-filter: blur(10px); /* Frosted glass effect */
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
        }
        h1 {
            @apply text-4xl font-extrabold text-gray-900 mb-10 text-center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            @apply text-3xl font-bold text-gray-800 mb-8 text-center;
        }
        label {
            @apply block text-gray-700 text-base font-semibold mb-2;
        }
        input[type="number"] {
            @apply shadow-inner appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-800 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out;
        }
        button {
            @apply bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-white shadow-lg transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-xl;
        }
        .result {
            @apply mt-8 text-center text-xl font-bold;
        }
        .error-message {
            @apply text-red-600 font-medium text-base mt-4 text-center;
        }
        .success-message {
            @apply text-green-700 font-extrabold;
        }
        /* Flexbox for responsiveness */
        .flex-wrap {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem; /* Consistent gap between calculators */
        }
        @media (min-width: 768px) {
            .calculator-container {
                max-width: 45%; /* Adjust width for larger screens to sit side-by-side */
            }
        }
        @media (min-width: 1024px) {
            .calculator-container {
                max-width: 40%; /* Further adjust for very large screens */
            }
        }

        /* --- Stabilizer Trim Calculator Specific Styles --- */
        .input-group label { /* Overriding existing label for consistency if needed, but this is fine */
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }
        .input-group input[type="number"] { /* Overriding existing number input for consistency */
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px 15px;
            width: 100%;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        .input-group input[type="number"]:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        .radio-group label {
            cursor: default;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f5f7fa;
            color: #555;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group label span {
            margin-left: 10px;
            position: relative;
        }
        .radio-group label span::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            position: absolute;
            left: -28px;
            top: 50%;
            transform: translateY(-50%);
        }
        .radio-group input[type="radio"]:checked + span {
            color: #4f46e5;
            font-weight: 600;
        }
        .radio-group input[type="radio"]:checked + span::before {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .result-box {
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            color: #4f46e5;
        }
        .error-message.stabilizer-error { /* Specific class for stabilizer error message */
            color: #dc2626;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        /* Message Box from Stabilizer Trim Calculator */
        #messageBox {
            z-index: 1000; /* Ensure it's on top */
        }
    </style>
</head>
<body>
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Citation X Performance</h1>

    <div class="flex flex-wrap justify-center gap-8 w-full">
        <!-- Takeoff Distance Calculator -->
        <div class="calculator-container">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Takeoff Field Length (15° Flaps)</h2>
            <form id="takeoffForm" class="space-y-4">
                <div>
                    <label for="takeoffElevation">Elevation (ft):</label>
                    <input type="number" id="takeoffElevation" value="0" min="0" max="9000" step="1"
                           class="mt-1">
                </div>
                <div>
                    <label for="takeoffTemp">Temperature (°C):</label>
                    <input type="number" id="takeoffTemp" value="15"
                           class="mt-1">
                </div>
                <div>
                    <label for="takeoffWeight">Takeoff Weight (lb):</label>
                    <input type="number" id="takeoffWeight" value="29000" min="25000" max="36100"
                           class="mt-1">
                </div>
                <button type="submit" class="w-full">Calculate Takeoff Distance</button>
            </form>
            <div class="result" id="takeoffResult"></div>
            <div class="error-message hidden" id="takeoffErrorMessage"></div>
        </div>

        <!-- Landing Distance Calculator -->
        <div class="calculator-container">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Landing Distance (Flaps Full)</h2>
            <form id="landingForm" class="space-y-4">
                <div>
                    <label for="landingElevation">Elevation (ft):</label>
                    <input type="number" id="landingElevation" value="0" min="0" max="8000" step="1"
                           class="mt-1">
                </div>
                <div>
                    <label for="landingTemp">Temperature (°C):</label>
                    <input type="number" id="landingTemp" value="15"
                           class="mt-1">
                </div>
                <div>
                    <label for="landingWeight">Landing Weight (lb):</label>
                    <input type="number" id="landingWeight" value="29000" min="23000" max="31800"
                           class="mt-1">
                </div>
                <button type="submit" class="w-full">Calculate Landing Distance</button>
            </form>
            <div class="result" id="landingResult"></div>
            <div class="error-message hidden" id="landingErrorMessage"></div>
        </div>

        <!-- Stabilizer Trim Calculator -->
        <div class="calculator-container">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Stabilizer Trim Position</h2>

            <div class="mb-6 input-group">
                <label for="macInput" class="block text-sm mb-2">Aircraft CG % MAC:</label>
                <input type="number" id="macInput" class="form-input" placeholder="Enter %MAC (15-35)" min="15" max="35" step="0.1">
                <p id="macError" class="error-message stabilizer-error">Please enter a %MAC value between 15 and 35.</p>
            </div>

            <div class="mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Flap Setting:</label>
                <div class="flex flex-col sm:flex-row gap-4 radio-group">
                    <label for="flaps15" class="flex-1">
                        <input type="radio" id="flaps15" name="flapSetting" value="flaps15" checked disabled>
                        <span><i class="fas fa-plane-arrival text-xl mr-2 text-purple-500"></i>Flaps 15 Degrees</span>
                    </label>
                </div>
            </div>

            <button id="calculateTrimBtn" class="mb-6 w-full">Calculate Trim</button>

            <div id="trimResultOutput" class="result-box hidden">
                Stabilizer Trim Position: <span id="trimValue" class="text-indigo-700"></span> Degrees
            </div>
        </div>
    </div>

    <!-- Global message box for all calculators -->
    <div id="messageBox" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
            <h3 class="text-lg font-bold mb-4" id="messageBoxTitle"></h3>
            <p class="text-gray-700 mb-6" id="messageBoxContent"></p>
            <button onclick="hideMessageBox()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>

    <script>
        // Helper function: Finds the two bracketing values in a sorted array for a given value.
        // It now returns null if the value is outside the array's range to prevent extrapolation.
        function bracket(arr, val) {
            // Ensure the array is sorted numerically
            arr = arr.map(Number).sort((a, b) => a - b);

            // If the value is strictly less than the minimum or strictly greater than the maximum,
            // return null to indicate out-of-bounds and prevent extrapolation.
            if (val < arr[0] || val > arr[arr.length - 1]) {
                return null;
            }

            // If the value matches an exact point, return that point duplicated
            if (arr.includes(val)) {
                return [val, val];
            }

            // Find the two values that bracket the input value
            for (let i = 0; i < arr.length - 1; i++) {
                if (val >= arr[i] && val <= arr[i + 1]) {
                    return [arr[i], arr[i + 1]];
                }
            }
            // This part should technically not be reached if the above checks are correct,
            // but as a fallback, return null to be safe.
            return null;
        }

        // Helper function for linear interpolation between two points (x0, y0) and (x1, y1)
        // at a given x value.
        function linearInterp(x0, x1, y0, y1, x) {
            if (x0 === x1) return y0; // Avoid division by zero if points are the same
            return y0 + (y1 - y0) * (x - x0) / (x1 - x0);
        }

        /**
         * Performs trilinear interpolation (sequential linear interpolation across three dimensions).
         * @param {object} dataTable - The data table for interpolation.
         * @param {number} elev - The target elevation.
         * @param {number} temp - The target temperature.
         * @param {number} weight - The target weight.
         * @returns {number | null} The interpolated field length, or null if extrapolation is needed.
         */
        function interpolate(dataTable, elev, temp, weight) {
            // Step 1: Interpolate for weight at an exact elevation and exact temperature.
            function getFieldLengthAtExactET(e, t, w) {
                const weights = Object.keys(dataTable[e][t]).map(Number).sort((a, b) => a - b);
                const bracketedWeights = bracket(weights, w);
                if (!bracketedWeights) {
                    throw new Error(`Weight ${w} lb is out of range for Temp ${t}°C and Elevation ${e} ft.`);
                }
                const [w0, w1] = bracketedWeights;

                const v0 = dataTable[e][t][w0];
                const v1 = dataTable[e][t][w1];

                return linearInterp(w0, w1, v0, v1, w);
            }

            // Step 2: Interpolate for temperature at an exact elevation and target weight.
            function getFieldLengthAtExactE(e, targetTemp, targetWeight) {
                const temps = Object.keys(dataTable[e]).map(Number).sort((a, b) => a - b);
                const bracketedTemps = bracket(temps, targetTemp);
                if (!bracketedTemps) {
                    throw new Error(`Temperature ${targetTemp}°C is out of range for Elevation ${e} ft.`);
                }
                const [t0, t1] = bracketedTemps;

                // Get field lengths at the bracketing temperatures for the target weight
                // This might throw an error if the weight is out of range for T0 or T1
                const val_t0 = getFieldLengthAtExactET(e, t0, targetWeight);
                const val_t1 = getFieldLengthAtExactET(e, t1, targetWeight);

                return linearInterp(t0, t1, val_t0, val_t1, targetTemp);
            }

            // Step 3: Main interpolation: Interpolate for elevation.
            const elevs = Object.keys(dataTable).map(Number).sort((a, b) => a - b);
            const bracketedElevs = bracket(elevs, elev);
            if (!bracketedElevs) {
                throw new Error(`Elevation ${elev} ft is out of range.`);
            }
            const [e0, e1] = bracketedElevs;

            // Get field lengths at the bracketing elevations for the target temperature and weight
            // This might throw an error if temp or weight are out of range for E0 or E1
            const val_e0 = getFieldLengthAtExactE(e0, temp, weight);
            const val_e1 = getFieldLengthAtExactE(e1, temp, weight);

            return linearInterp(e0, e1, val_e0, val_e1, elev);
        }

        // Takeoff Data: Elevation (ft) -> Temperature (°C) -> Weight (lb) -> Field Length (ft)
        // All values from pages 7-9 and page 11 of the Citation X Flight Planning Guide (15° flaps)
        const takeoffData = {
            0: {
                0: { 36100: 4890, 35000: 4610, 34000: 4340, 33000: 4080, 31000: 3680, 29000: 3520, 27000: 3440, 25000: 3360 },
                10: { 36100: 5050, 35000: 4760, 34000: 4490, 33000: 4220, 31000: 3800, 29000: 3620, 27000: 3520, 25000: 3440 },
                15: { 36100: 5140, 35000: 4850, 34000: 4560, 33000: 4300, 31000: 3850, 29000: 3670, 27000: 3560, 25000: 3480 },
                20: { 36100: 5230, 35000: 4930, 34000: 4640, 33000: 4370, 31000: 3920, 29000: 3730, 27000: 3600, 25000: 3510 },
                25: { 36100: 5340, 35000: 5030, 34000: 4740, 33000: 4460, 31000: 3990, 29000: 3800, 27000: 3640, 25000: 3550 },
                30: { 36100: 5480, 35000: 5150, 34000: 4850, 33000: 4560, 31000: 4060, 29000: 3870, 27000: 3690, 25000: 3600 },
                35: { 36100: 5910, 35000: 5520, 34000: 5200, 33000: 4890, 31000: 4260, 29000: 3890, 27000: 3710, 25000: 3560 },
                40: { 36100: 6450, 35000: 6000, 34000: 5620, 33000: 5270, 31000: 4580, 29000: 3970, 27000: 3730, 25000: 3530 },
                45: { 34000: 6110, 33000: 5720, 31000: 4950, 29000: 4280, 27000: 3730, 25000: 3540 },
                50: { 31000: 5390, 29000: 4630, 27000: 3990, 25000: 3550 }
            },
            1000: {
                0: { 36100: 5050, 35000: 4760, 34000: 4480, 33000: 4220, 31000: 3800, 29000: 3630, 27000: 3540, 25000: 3460 },
                10: { 36100: 5220, 35000: 4920, 34000: 4640, 33000: 4370, 31000: 3920, 29000: 3730, 27000: 3630, 25000: 3540 },
                15: { 36100: 5310, 35000: 5010, 34000: 4720, 33000: 4440, 31000: 3980, 29000: 3790, 27000: 3670, 25000: 3580 },
                20: { 36100: 5420, 35000: 5100, 34000: 4810, 33000: 4520, 31000: 4050, 29000: 3860, 27000: 3710, 25000: 3620 },
                25: { 36100: 5550, 35000: 5210, 34000: 4910, 33000: 4620, 31000: 4130, 29000: 3930, 27000: 3750, 25000: 3660 },
                30: { 36100: 5930, 35000: 5530, 34000: 5210, 33000: 4900, 31000: 4270, 29000: 3980, 27000: 3780, 25000: 3650 },
                35: { 36100: 6480, 35000: 6030, 34000: 5640, 33000: 5290, 31000: 4600, 29000: 3990, 27000: 3800, 25000: 3600 },
                40: { 35000: 6590, 34000: 6120, 33000: 5730, 31000: 4970, 29000: 4290, 27000: 3810, 25000: 3610 },
                45: { 33000: 6240, 31000: 5390, 29000: 4640, 27000: 4010, 25000: 3630 },
                50: { 31000: 5880, 29000: 5040, 27000: 4330, 25000: 3700 }
            },
            2000: {
                0: { 36100: 5210, 35000: 4920, 34000: 4630, 33000: 4360, 31000: 3930, 29000: 3750, 27000: 3660, 25000: 3570 },
                10: { 36100: 5400, 35000: 5080, 34000: 4790, 33000: 4510, 31000: 4060, 29000: 3860, 27000: 3740, 25000: 3650 },
                15: { 36100: 5510, 35000: 5170, 34000: 4880, 33000: 4590, 31000: 4120, 29000: 3920, 27000: 3780, 25000: 3690 },
                20: { 36100: 5640, 35000: 5280, 34000: 4980, 33000: 4680, 31000: 4200, 29000: 4000, 27000: 3820, 25000: 3730 },
                25: { 36100: 5960, 35000: 5560, 34000: 5220, 33000: 4920, 31000: 4290, 29000: 4050, 27000: 3850, 25000: 3730 },
                30: { 36100: 6500, 35000: 6040, 34000: 5650, 33000: 5300, 31000: 4620, 29000: 4050, 27000: 3870, 25000: 3690 },
                35: { 35000: 6610, 34000: 6140, 33000: 5740, 31000: 4990, 29000: 4310, 27000: 3890, 25000: 3680 },
                40: { 33000: 6250, 31000: 5400, 29000: 4650, 27000: 4020, 25000: 3710 },
                45: { 31000: 5880, 29000: 5040, 27000: 4340, 25000: 3710 },
                50: { 29000: 5490, 27000: 4710, 25000: 4010 }
            },
            3000: {
                "-10": { 36100: 5220, 35000: 4920, 34000: 4640, 33000: 4370, 31000: 3930, 29000: 3750, 27000: 3660, 25000: 3570 },
                0: { 36100: 5410, 35000: 5090, 34000: 4800, 33000: 4510, 31000: 4060, 29000: 3870, 27000: 3770, 25000: 3680 },
                10: { 36100: 5620, 35000: 5260, 34000: 4960, 33000: 4670, 31000: 4190, 29000: 3990, 27000: 3850, 25000: 3760 },
                15: { 36100: 5740, 35000: 5370, 34000: 5060, 33000: 4760, 31000: 4260, 29000: 4060, 27000: 3890, 25000: 3800 },
                20: { 36100: 6000, 35000: 5600, 34000: 5260, 33000: 4950, 31000: 4320, 29000: 4120, 27000: 3910, 25000: 3810 },
                25: { 36100: 6530, 35000: 6080, 34000: 5670, 33000: 5330, 31000: 4640, 29000: 4130, 27000: 3950, 25000: 3770 },
                30: { 35000: 6640, 34000: 6180, 33000: 5770, 31000: 5010, 29000: 4340, 27000: 3970, 25000: 3750 },
                35: { 34000: 6760, 33000: 6260, 31000: 5420, 29000: 4670, 27000: 4040, 25000: 3780 },
                40: { 31000: 5890, 29000: 5060, 27000: 4360, 25000: 3770 },
                45: { 29000: 5500, 27000: 4720, 25000: 4020 }
            },
            4000: {
                "-10": { 36100: 5420, 35000: 5100, 34000: 4800, 33000: 4520, 31000: 4060, 29000: 3870, 27000: 3780, 25000: 3680 },
                0: { 36100: 5630, 35000: 5270, 34000: 4970, 33000: 4680, 31000: 4190, 29000: 3990, 27000: 3880, 25000: 3790 },
                10: { 36100: 5850, 35000: 5460, 34000: 5140, 33000: 4840, 31000: 4330, 29000: 4120, 27000: 3970, 25000: 3870 },
                15: { 36100: 6040, 35000: 5640, 34000: 5290, 33000: 4980, 31000: 4390, 29000: 4190, 27000: 3990, 25000: 3890 },
                20: { 36100: 6580, 35000: 6130, 34000: 5710, 33000: 5360, 31000: 5040, 29000: 4360, 27000: 4050, 25000: 3820 },
                25: { 36100: 7190, 35000: 6680, 34000: 6210, 33000: 5790, 31000: 5040, 29000: 4360, 27000: 4050, 25000: 3820 },
                30: { 34000: 6800, 33000: 6310, 31000: 5450, 29000: 4710, 27000: 4070, 25000: 3850 },
                35: { 31000: 5910, 29000: 5080, 27000: 4380, 25000: 3860 },
                40: { 29000: 5520, 27000: 4750, 25000: 4040 },
                45: { 29000: 6000, 27000: 5130, 25000: 4360 }
            },
            5000: {
                "-10": { 36100: 5610, 35000: 5260, 34000: 4960, 33000: 4670, 31000: 4200, 29000: 4000, 27000: 3900, 25000: 3800 },
                0: { 36100: 5840, 35000: 5450, 34000: 5130, 33000: 4830, 31000: 4340, 29000: 4130, 27000: 4010, 25000: 3910 },
                5: { 36100: 5950, 35000: 5550, 34000: 5210, 33000: 4910, 31000: 4410, 29000: 4200, 27000: 4050, 25000: 3950 },
                10: { 36100: 6120, 35000: 5710, 34000: 5340, 33000: 5030, 31000: 4470, 29000: 4260, 27000: 4080, 25000: 3980 },
                15: { 36100: 6630, 35000: 6170, 34000: 5760, 33000: 5400, 31000: 4710, 29000: 4290, 27000: 4080, 25000: 3930 },
                20: { 36100: 7250, 35000: 6730, 34000: 6260, 33000: 5830, 31000: 5070, 29000: 4400, 27000: 4120, 25000: 3890 },
                25: { 34000: 6830, 33000: 6340, 31000: 5470, 29000: 4730, 27000: 4120, 25000: 3920 },
                30: { 33000: 6930, 31000: 5930, 29000: 5110, 27000: 4410, 25000: 3940 },
                35: { 31000: 6460, 29000: 5530, 27000: 4760, 25000: 4060 },
                40: { 29000: 6020, 27000: 5150, 25000: 4380 }
            },
            6000: {
                "-10": { 36100: 5930, 35000: 5540, 34000: 5210, 33000: 4900, 31000: 4320, 29000: 4120, 27000: 4000, 25000: 3900 },
                0: { 36100: 6170, 35000: 5760, 34000: 5380, 33000: 5070, 31000: 4470, 29000: 4260, 27000: 4110, 25000: 4000 },
                5: { 36100: 6300, 35000: 5870, 34000: 5480, 33000: 5160, 31000: 4540, 29000: 4330, 27000: 4150, 25000: 4050 },
                10: { 36100: 6680, 35000: 6220, 34000: 5800, 33000: 5430, 31000: 4740, 29000: 4380, 27000: 4160, 25000: 4020 },
                15: { 36100: 7310, 35000: 6780, 34000: 6310, 33000: 5870, 31000: 5110, 29000: 4430, 27000: 4190, 25000: 3980 },
                20: { 35000: 7410, 34000: 6870, 33000: 6380, 31000: 5500, 29000: 4760, 27000: 4210, 25000: 3990 },
                25: { 33000: 6940, 31000: 6360, 29000: 5120, 27000: 4420, 25000: 4030 },
                30: { 31000: 6870, 29000: 5470, 27000: 4720, 25000: 4030 },
                35: { 29000: 5870, 27000: 5040, 25000: 4300 },
                40: { 29000: 6320, 27000: 5400, 25000: 4590 }
            },
            7000: {
                "-20": { 31800: 3870, 31000: 3670, 30000: 3470, 28000: 3290, 26000: 3080, 25000: 2980, 24000: 2880, 23000: 2790 },
                "-10": { 31800: 4050, 31000: 3830, 30000: 3590, 28000: 3380, 26000: 3170, 25000: 3070, 24000: 2960, 23000: 2860 },
                0: { 31800: 4240, 31000: 4000, 30000: 3730, 28000: 3470, 26000: 3260, 25000: 3150, 24000: 3040, 23000: 2940 },
                5: { 31800: 4340, 31000: 4080, 30000: 3810, 28000: 3520, 26000: 3300, 25000: 3190, 24000: 3080, 23000: 2980 },
                10: { 31800: 4440, 31000: 4170, 30000: 3880, 28000: 3560, 26000: 3340, 25000: 3230, 24000: 3120, 23000: 3010 },
                15: { 31800: 4550, 31000: 4260, 30000: 3960, 28000: 3610, 26000: 3380, 25000: 3270, 24000: 3160, 23000: 3050 },
                20: { 31800: 4660, 31000: 4350, 30000: 4030, 28000: 3650, 26000: 3420, 25000: 3310, 24000: 3200, 23000: 3080 },
                25: { 31800: 4770, 31000: 4440, 30000: 4120, 28000: 3700, 26000: 3460, 25000: 3350, 24000: 3230, 23000: 3120 },
                30: { 31800: 4880, 31000: 4530, 30000: 4200, 28000: 3740, 26000: 3500, 25000: 3390, 24000: 3270, 23000: 3160 },
                35: { 31800: 4990, 31000: 4620, 30000: 4280, 28000: 3790, 26000: 3540, 25000: 3430, 24000: 3300, 23000: 3200 }
            },
            8000: {
                "-20": { 31800: 4050, 31000: 3820, 30000: 3590, 28000: 3380, 26000: 3170, 25000: 3070, 24000: 2970, 23000: 2870 },
                "-10": { 31800: 4240, 31000: 4000, 30000: 3730, 28000: 3470, 26000: 3260, 25000: 3150, 24000: 3040, 23000: 2940 },
                0: { 31800: 4440, 31000: 4170, 30000: 3880, 28000: 3560, 26000: 3340, 25000: 3230, 24000: 3120, 23000: 3010 },
                5: { 31800: 4550, 31000: 4260, 30000: 3960, 28000: 3610, 26000: 3380, 25000: 3270, 24000: 3160, 23000: 3050 },
                10: { 31800: 4660, 31000: 4350, 30000: 4030, 28000: 3650, 26000: 3420, 25000: 3310, 24000: 3200, 23000: 3080 },
                15: { 31800: 4770, 31000: 4440, 30000: 4120, 28000: 3700, 26000: 3460, 25000: 3350, 24000: 3230, 23000: 3120 },
                20: { 31800: 4880, 31000: 4530, 30000: 4200, 28000: 3740, 26000: 3500, 25000: 3390, 24000: 3270, 23000: 3160 },
                25: { 31800: 4990, 31000: 4630, 30000: 4280, 28000: 3790, 26000: 3540, 25000: 3430, 24000: 3300, 23000: 3200 },
                30: { 31000: 4720, 30000: 4360, 28000: 3830, 26000: 3580, 25000: 3460, 24000: 3340, 23000: 3240 },
                35: { 30000: 4440, 28000: 3880, 26000: 3620, 25000: 3500, 24000: 3380, 23000: 3270 }
            }
        };

        // Takeoff Calculator Logic
        document.getElementById('takeoffForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const elevation = parseFloat(document.getElementById('takeoffElevation').value);
            const temperature = parseFloat(document.getElementById('takeoffTemp').value);
            const weight = parseFloat(document.getElementById('takeoffWeight').value);
            const resultDiv = document.getElementById('takeoffResult');
            const errorDiv = document.getElementById('takeoffErrorMessage');

            resultDiv.innerHTML = ''; // Clear previous results
            errorDiv.classList.add('hidden'); // Hide previous errors

            try {
                const fieldLength = interpolate(takeoffData, elevation, temperature, weight);
                if (fieldLength !== null && !isNaN(fieldLength)) {
                    resultDiv.innerHTML = `<span class="success-message">Takeoff Field Length: ${Math.round(fieldLength)} ft</span>`;
                } else {
                    throw new Error("Cannot calculate: Input values are out of table range, or data is insufficient for interpolation.");
                }
            } catch (error) {
                errorDiv.textContent = `Error: ${error.message}`;
                errorDiv.classList.remove('hidden');
                showMessageBox("Calculation Error", `Takeoff: ${error.message}`);
            }
        });

        // Landing Calculator Logic
        document.getElementById('landingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const elevation = parseFloat(document.getElementById('landingElevation').value);
            const temperature = parseFloat(document.getElementById('landingTemp').value);
            const weight = parseFloat(document.getElementById('landingWeight').value);
            const resultDiv = document.getElementById('landingResult');
            const errorDiv = document.getElementById('landingErrorMessage');

            resultDiv.innerHTML = ''; // Clear previous results
            errorDiv.classList.add('hidden'); // Hide previous errors

            try {
                const fieldLength = interpolate(landingData, elevation, temperature, weight);
                if (fieldLength !== null && !isNaN(fieldLength)) {
                    resultDiv.innerHTML = `<span class="success-message">Landing Distance: ${Math.round(fieldLength)} ft</span>`;
                } else {
                    throw new Error("Cannot calculate: Input values are out of table range, or data is insufficient for interpolation.");
                }
            } catch (error) {
                errorDiv.textContent = `Error: ${error.message}`;
                errorDiv.classList.remove('hidden');
                showMessageBox("Calculation Error", `Landing: ${error.message}`);
            }
        });

        // Function to show a custom message box (re-used for all calculators)
        function showMessageBox(title, message) {
            document.getElementById('messageBoxTitle').innerText = title;
            document.getElementById('messageBoxContent').innerText = message;
            document.getElementById('messageBox').classList.remove('hidden');
        }

        // Function to hide the custom message box (re-used for all calculators)
        function hideMessageBox() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        // Stabilizer Trim Calculator Logic
        document.getElementById('calculateTrimBtn').addEventListener('click', function() {
            const macInput = document.getElementById('macInput');
            const mac = parseFloat(macInput.value);
            const resultOutput = document.getElementById('trimResultOutput');
            const trimValueSpan = document.getElementById('trimValue');
            const macError = document.getElementById('macError');

            // Input validation
            if (isNaN(mac) || mac < 15 || mac > 35) {
                macInput.classList.add('border-red-500');
                macError.style.display = 'block'; // Show error message
                resultOutput.classList.add('hidden'); // Hide previous result if any
                showMessageBox("Input Error", "Please enter a valid %MAC value between 15 and 35 for Stabilizer Trim.");
                return; // Stop execution if input is invalid
            } else {
                macInput.classList.remove('border-red-500');
                macError.style.display = 'none'; // Hide error message
            }

            // Linear regression equation for Flaps 15 using points (15, -8), (29, -4.8), (35, -3.5)
            // Slope (m) = 0.2256329
            // Y-intercept (b) = -11.375333
            const slope = 0.2256329;
            const intercept = -11.375333;
            // Round to 1 decimal place
            const trimPosition = (slope * mac + intercept).toFixed(1); 

            trimValueSpan.textContent = trimPosition;
            resultOutput.classList.remove('hidden');
        });
    </script>
</body>
</html>
