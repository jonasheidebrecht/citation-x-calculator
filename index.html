<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citation X Landing Distance Interpolator (15° Flaps)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, select { margin: 4px; }
    .result { margin-top: 20px; font-size: 1.2em; color: #003366; }
  </style>
</head>
<body>
  <h2>Citation X Landing Distance (15° Flaps) Interpolator</h2>
  <form id="interpForm">
    <label>Elevation (ft): <input type="number" id="elevation" value="0" min="0" max="8000" step="1"></label>
    <label>Temperature (°C): <input type="number" id="temp" value="0"></label>
    <label>Landing Weight (lb): <input type="number" id="weight" value="23000" min="23000" max="31800"></label>
    <button type="submit">Interpolate</button>
  </form>
  <div class="result" id="result"></div>
  <script>
    // Citation X Landing Distance Table (15° Flaps, Dry Runway, from page 24)
    // Elevation(ft) -> Temp(°C) -> Weight(lb) -> Distance(ft)
    const landingData = {
      0: {
        "-20": {31800: 3160, 31000: 3080, 29000: 2880, 27000: 2700, 25000: 2540, 23000: 2390},
        "-10": {31800: 3200, 31000: 3120, 29000: 2920, 27000: 2740, 25000: 2580, 23000: 2430},
        "0":   {31800: 3240, 31000: 3160, 29000: 2960, 27000: 2780, 25000: 2620, 23000: 2490},
        "10":  {31800: 3290, 31000: 3210, 29000: 3010, 27000: 2830, 25000: 2670, 23000: 2540},
        "15":  {31800: 3320, 31000: 3240, 29000: 3040, 27000: 2860, 25000: 2700, 23000: 2570},
        "20":  {31800: 3350, 31000: 3270, 29000: 3070, 27000: 2890, 25000: 2730, 23000: 2600},
        "25":  {31800: 3380, 31000: 3300, 29000: 3100, 27000: 2920, 25000: 2760, 23000: 2630},
        "30":  {31800: 3410, 31000: 3330, 29000: 3130, 27000: 2950, 25000: 2790, 23000: 2660}
      },
      1000: {
        "-20": {31800: 3210, 31000: 3130, 29000: 2930, 27000: 2750, 25000: 2590, 23000: 2440},
        "-10": {31800: 3250, 31000: 3170, 29000: 2970, 27000: 2790, 25000: 2630, 23000: 2480},
        "0":   {31800: 3290, 31000: 3210, 29000: 3010, 27000: 2830, 25000: 2670, 23000: 2520},
        "10":  {31800: 3340, 31000: 3260, 29000: 3060, 27000: 2880, 25000: 2720, 23000: 2570},
        "15":  {31800: 3370, 31000: 3290, 29000: 3090, 27000: 2910, 25000: 2750, 23000: 2600},
        "20":  {31800: 3400, 31000: 3320, 29000: 3120, 27000: 2940, 25000: 2780, 23000: 2630},
        "25":  {31800: 3430, 31000: 3350, 29000: 3150, 27000: 2970, 25000: 2810, 23000: 2660},
        "30":  {31800: 3460, 31000: 3380, 29000: 3180, 27000: 3000, 25000: 2840, 23000: 2690}
      },
      // ...repeat for 2000, 3000, ..., 8000 ft
    };

    // Helper: Find two bracketing values in an array for a given value
    function bracket(arr, val) {
      arr = arr.map(Number).sort((a, b) => a - b);
      if (val <= arr[0]) return [arr[0], arr[0]];
      if (val >= arr[arr.length - 1]) return [arr[arr.length - 1], arr[arr.length - 1]];
      for (let i = 0; i < arr.length - 1; i++) {
        if (val >= arr[i] && val <= arr[i + 1]) return [arr[i], arr[i + 1]];
      }
    }

    // Tri-linear interpolation: first weight, then temp, then elev
    function interpolate(elev, temp, weight) {
      const elevs = Object.keys(landingData).map(Number);
      const [e0, e1] = bracket(elevs, elev);

      function getTemps(e) { return Object.keys(landingData[e]).map(Number); }
      const [t0, t1] = bracket(getTemps(e0), temp);
      const [t2, t3] = bracket(getTemps(e1), temp);

      function getWeights(e, t) { return Object.keys(landingData[e][t]).map(Number); }
      function interpWeight(e, t, w) {
        const weights = getWeights(e, t);
        const [w0, w1] = bracket(weights, w);
        const v0 = landingData[e][t][w0];
        const v1 = landingData[e][t][w1];
        return w0 === w1 ? v0 : v0 + (v1 - v0) * (w - w0) / (w1 - w0);
      }
      function interp(x0, x1, y0, y1, x) {
        return x0 === x1 ? y0 : y0 + (y1 - y0) * (x - x0) / (x1 - x0);
      }
      // Interpolate weight at each temp/elev
      const v_e0_t0 = interpWeight(e0, t0, weight);
      const v_e0_t1 = interpWeight(e0, t1, weight);
      const v_e1_t2 = interpWeight(e1, t2, weight);
      const v_e1_t3 = interpWeight(e1, t3, weight);

      // Interpolate temp at each elev
      const v_e0 = interp(t0, t1, v_e0_t0, v_e0_t1, temp);
      const v_e1 = interp(t2, t3, v_e1_t2, v_e1_t3, temp);

      // Interpolate elevation
      return interp(e0, e1, v_e0, v_e1, elev);
    }

    document.getElementById('interpForm').addEventListener('submit', function(e){
      e.preventDefault();
      const elev = parseFloat(document.getElementById('elevation').value);
      const temp = parseFloat(document.getElementById('temp').value);
      const weight = parseFloat(document.getElementById('weight').value);

      const elevs = Object.keys(landingData).map(Number);
      if (elev < Math.min(...elevs) || elev > Math.max(...elevs)) {
        document.getElementById('result').textContent = "Elevation out of data range.";
        return;
      }
      function getTemps(e) { return Object.keys(landingData[e]).map(Number); }
      const temps0 = getTemps(bracket(elevs, elev)[0]), temps1 = getTemps(bracket(elevs, elev)[1]);
      if (temp < Math.min(...temps0, ...temps1) || temp > Math.max(...temps0, ...temps1)) {
        document.getElementById('result').textContent = "Temperature out of data range for this elevation.";
        return;
      }
      function getWeights(e, t) { return Object.keys(landingData[e][t]).map(Number); }
      const [e0, e1] = bracket(elevs, elev);
      const [t0, t1] = bracket(getTemps(e0), temp);
      const [t2, t3] = bracket(getTemps(e1), temp);
      const ws00 = getWeights(e0, t0), ws01 = getWeights(e0, t1);
      const ws10 = getWeights(e1, t2), ws11 = getWeights(e1, t3);
      const minW = Math.min(...ws00, ...ws01, ...ws10, ...ws11);
      const maxW = Math.max(...ws00, ...ws01, ...ws10, ...ws11);
      if (weight < minW || weight > maxW) {
        document.getElementById('result').textContent = "Weight out of data range.";
        return;
      }

      const fieldLen = interpolate(elev, temp, weight);
      document.getElementById('result').innerHTML = `<b>Estimated Landing Distance:</b> <span style="color:darkgreen">${fieldLen.toFixed(0)} ft</span>`;
    });
  </script>
</body>
</html>
